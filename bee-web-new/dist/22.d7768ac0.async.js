(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[22],{"6GOd":function(e,t,a){},GNML:function(e,t,a){"use strict";var n=a("7rOj"),l=a("SyOF");Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0,a("+L6B");var o=n(a("2/Rp"));a("5NDa");var s=n(a("5rEg")),i=n(a("m6D0"));a("miYZ");var r=n(a("tsqr")),u=n(a("M6Zy")),c=n(a("iyqV")),d=n(a("utfd")),g=n(a("o7c0")),m=n(a("sMup"));a("y8nQ");var f=n(a("Vl3Y")),h=l(a("COVA"));a("6GOd");var p,S,v,E=a("jBtN"),y=n(a("xIpT")),N=n(a("oEWm")),k=n(a("KIHU")),P=a("MuoO"),T=a("3eXy"),C=(E.utils.clearUserInfo,E.go.con),b=E.go.tms,x=E.go.supplychain,I=E.go.trade,w=E.go.ERP,O=E.go.OA,B=E.go.ifms,L=f["default"].Item,F=(p=(0,P.connect)(function(e){var t=e.global;return{global:t}}),(0,N["default"])(S=p((v=function(e){function t(e){var a;return(0,u["default"])(this,t),a=(0,d["default"])(this,(0,g["default"])(t).call(this,e)),a.handleEnterKey=function(e){var t=a.state.isShow;13===e.which&&(t?a.login("login"):a.login("loginCode"))},a.clickItem=function(e){a.setState({isShow:e})},a.timeOut=function(e){e-=1,a.setState({time:e})},a.runtime=function(){a.setState({showTime:!0},function(){if(0===U)return a.setState({showTime:!1,getCodeText:"\u91cd\u65b0\u83b7\u53d6"}),U=60,!1;U--,a.setState({time:U}),a.loginTimer=setTimeout(function(){a.runtime()},1e3)})},a.settime=function(){var e=a.props.form.getFieldValue("username"),t=/^1[3|4|5|6|7|8|9][0-9]{9}$/,n=e.match(t)&&e.match(t)[0];n&&60===U&&(0,T.getLoginCode)({phone:n}).then(function(e){e&&(0===e.code?(r["default"].success(e.message),a.runtime()):r["default"].error(e.message))})},a.getUserInfo=function(e,t){var n=a.props.dispatch,l=!1;sessionStorage.originPath&&(l=-1!==sessionStorage.originPath.indexOf("perLogin")||-1!==sessionStorage.originPath.indexOf("getBack")||-1!==sessionStorage.originPath.indexOf("register")),localStorage.sysToken&&n({type:"global/getSelfInfo",payload:{sysToken:localStorage.sysToken},callback:function(n,o,s){if(0===n)if(e){var i=!0;sessionStorage.loginSuccessNextPageTime&&sessionStorage.originPathTime&&(i=Number(sessionStorage.loginSuccessNextPageTime)>Number(sessionStorage.originPathTime)),sessionStorage.loginSuccessNextPage&&i?a.nextPage(t):void 0===sessionStorage.originPath||sessionStorage.originPath&&l?k["default"].push("/"):k["default"].push(sessionStorage.originPath)}else void 0===sessionStorage.originPath||sessionStorage.originPath&&l?k["default"].push("/"):k["default"].push(sessionStorage.originPath)}})},a.nextPage=function(e){var t=sessionStorage.loginSuccessNextPage,a=localStorage.tradeType;sessionStorage.removeItem("loginSuccessNextPage"),localStorage.removeItem("tradeType"),t&&("con"===t?C(e):"tms"===t?(b(),k["default"].push("/")):"supplychain"===t?(x(),k["default"].push("/")):"trade"===t?(a?I(a):I(),k["default"].push("/")):"ERP"===t?w():"OA"===t?(O(),k["default"].push("/")):"ifms"===t?B():k["default"].push("/"))},a.getUserCompanyInfo=function(e,t){var n=a.props.dispatch;localStorage.sysToken&&n({type:"global/getEnterprises",payload:{sysToken:localStorage.sysToken},callback:function(n,l,o){if(0===n)if(o.length>=1){var s=e||o[0].id;(0,T.changeEnterprise)(s).then(function(e){0===e.code&&a.getUserInfo(!0,t)})}else a.getUserInfo(!1,t),k["default"].push("/")}})},a.login=function(e){a.props.form.validateFields(function(t,n){if(!t&&n.username){var l=a.props.dispatch;l("login"===e?{type:"global/login",payload:(0,i["default"])({userType:0},n),callback:function(e,t,n){0===e?setTimeout(function(){a.getUserCompanyInfo(n.orgId,n.sysToken)},1e3):r["default"].error(t)}}:{type:"global/loginCode",payload:(0,i["default"])({},n),callback:function(e,t,n){0===e?setTimeout(function(){a.getUserCompanyInfo(n.orgId,n.sysToken)},1e3):r["default"].error(t)}})}})},a.getPhoneNumber=function(e){var t=/^1[3|4|5|6|7|8|9][0-9]{9}$/,n=e.target.value.match(t)&&e.target.value.match(t)[0];n?a.setState({isPhone:!0}):a.setState({isPhone:!1})},a.state={isShow:!0,showTime:!1,phoneChange:!1,getCodeText:"\u83b7\u53d6\u9a8c\u8bc1\u7801",time:null,isPhone:!1},a.loginSuccessNextPage=!1,a.loginTimer=null,a.isLoginOut=a.props.location.query.isLoginOut,a}return(0,m["default"])(t,e),(0,c["default"])(t,[{key:"componentDidMount",value:function(){this.isLoginOut?(localStorage.clear(),sessionStorage.clear(),k["default"].push("/perLogin")):localStorage.sysToken&&this.props.global.login&&k["default"].replace("/"),document.addEventListener("keydown",this.handleEnterKey.bind(this))}},{key:"componentWillUnmount",value:function(){clearTimeout(this.loginTimer),document.removeEventListener("keydown",this.handleEnterKey)}},{key:"componentWillReceiveProps",value:function(){var e=this.props.form.getFieldValue("username"),t=/^1[3|4|5|6|7|8|9][0-9]{9}$/,a=e&&e.match(t)&&e.match(t)[0];a?this.setState({isPhone:!0}):this.setState({isPhone:!1})}},{key:"render",value:function(){var e=this,t=this.state,n=t.isShow,l=t.showTime,i=t.time,r=t.getCodeText,u=(t.phoneChange,t.isPhone),c=this.props.form.getFieldDecorator;return h["default"].createElement("div",{className:"loginWrap"},h["default"].createElement("div",{className:"loginSlogan"},h["default"].createElement("div",{className:"loginSloganTitle"},"\u4e3a\u5de5\u4e1a\u8d4b\u80fd\uff0c\u4e0e\u4f19\u4f34\u5171\u751f"),h["default"].createElement("div",{className:"loginSloganContent"},"\u7acb\u8db3\u6570\u5b57\u5316\u8f6c\u578b\uff0c\u52a9\u529b\u4f01\u4e1a\u9ad8\u6548\u8fd0\u8425")),h["default"].createElement("div",{className:"loginBox"},h["default"].createElement("div",{className:"loginContent"},h["default"].createElement("ul",{className:"loginNav"},h["default"].createElement("li",{onClick:this.clickItem.bind(this,!0),className:n?"loginActive":"loginNormal"},"\u5bc6\u7801\u767b\u5f55"),h["default"].createElement("li",{onClick:this.clickItem.bind(this,!1),className:n?"loginNormal":"loginActive"},"\u77ed\u4fe1\u767b\u5f55")),n?h["default"].createElement("div",{className:"codeLogin"},h["default"].createElement(f["default"],{className:"loginForm"},h["default"].createElement(L,{className:"loginInputBox"},c("username",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u624b\u673a\u53f7\u7801/\u7528\u6237\u540d"}]})(h["default"].createElement(s["default"],{placeholder:"\u7528\u6237\u540d",style:{background:"rgba(0,0,0,0)"},prefix:h["default"].createElement("img",{src:a("vuBa")})}))),h["default"].createElement(L,{className:"loginInputBox"},c("password",{rules:[{required:!0,message:"\u8bf7\u586b\u5165\u5bc6\u7801"}]})(h["default"].createElement(s["default"],{type:"password",placeholder:"\u5bc6\u7801",prefix:h["default"].createElement("img",{src:a("QIkC")})}))),h["default"].createElement(L,null,h["default"].createElement("div",{className:"loginForgetCode"},h["default"].createElement(y["default"],{to:"/register"},"\u6ce8\u518c"),h["default"].createElement(y["default"],{to:"/getBack"},"\u5fd8\u8bb0\u5bc6\u7801\uff1f")),h["default"].createElement(o["default"],{className:"loginBtn",type:"primary",onClick:this.login.bind(this,"login")},"\u767b\u5f55")))):h["default"].createElement("div",{className:"phoneLogin"},h["default"].createElement(f["default"],{onSubmit:this.handleSubmit,className:"loginForm"},h["default"].createElement(L,{className:"loginInputBox"},c("username",{rules:[{required:!0,message:"\u624b\u673a\u53f7\u7801\u683c\u5f0f\u4e0d\u6b63\u786e\uff01",pattern:/^1[3|4|5|6|7|8|9][0-9]{9}$/}]})(h["default"].createElement(s["default"],{placeholder:"\u624b\u673a\u53f7\u7801",onChange:this.getPhoneNumber,ref:function(t){return e.inputPhone=t},prefix:h["default"].createElement("img",{src:a("Z+4C")})}))),h["default"].createElement(L,{className:"loginInputBox"},c("code",{rules:[{required:!0,message:"\u8bf7\u586b\u5165\u9a8c\u8bc1\u7801"}]})(h["default"].createElement(s["default"],{placeholder:"\u9a8c\u8bc1\u7801",prefix:h["default"].createElement("img",{src:a("hREe")}),className:"loginInputCode",suffix:h["default"].createElement("div",{className:"loginGetCode"},h["default"].createElement("span",{className:"loginLine"},"|"),h["default"].createElement("span",null,l?h["default"].createElement("span",{className:"loginNormalBtnClass",disabled:l},i,"s"):h["default"].createElement("span",{className:u?"loginBtnClass":"loginNormalBtnClass",onClick:u?this.settime:null},r)))}))),h["default"].createElement(L,null,h["default"].createElement("div",{className:"loginForgetCode"},h["default"].createElement(y["default"],{to:"/register"},"\u6ce8\u518c")),h["default"].createElement(o["default"],{className:"loginBtn",type:"primary",onClick:this.login.bind(this,"loginCode")},"\u767b\u5f55")))))))}}]),t}(h.Component),S=v))||S)||S),U=60,q=f["default"].create({})(F),M=q;t["default"]=M}}]);